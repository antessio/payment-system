<?xml version="1.0" encoding="UTF-8"?>
<databaseChangeLog
        xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
        xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
        xmlns:ext="http://www.liquibase.org/xml/ns/dbchangelog-ext"
        xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog
		http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-latest.xsd
		http://www.liquibase.org/xml/ns/dbchangelog-ext http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-ext.xsd">
<changeSet author="antessio" id="202302011119">
    <createTable tableName="bank-account" >
        <column name="id" type="UUID">
            <constraints nullable="false" primaryKey="true"/>
        </column>
        <column name="iban" type="VARCHAR(255)">
            <constraints nullable="false" />
        </column>
        <column name="owner" type="VARCHAR(255)">
            <constraints nullable="false" />
        </column>
        <column name="insertDate" type="TIMESTAMP WITHOUT TIME ZONE" defaultValue="now()"/>
        <column name="updateDate" type="TIMESTAMP WITHOUT TIME ZONE"/>
        <column name="version" type="bigint" defaultValue="0"/>
    </createTable>
    <createTable tableName="bank-transfer" >
        <column name="id" type="UUID">
            <constraints nullable="false" primaryKey="true"/>
        </column>
        <column name="amountUnit" type="bigint">
            <constraints nullable="false" />
        </column>
        <column name="currency" type="VARCHAR(3)">
            <constraints nullable="false" />
        </column>
        <column name="status" type="VARCHAR(255)">
            <constraints nullable="false" />
        </column>
        <column name="bankAccountId" type="UUID">
            <constraints nullable="false" />
        </column>
        <column name="executionDate" type="DATE" />
        <column name="reversalDate" type="DATE"/>
        <column name="insertDate" type="TIMESTAMP WITHOUT TIME ZONE" defaultValue="now()"/>
        <column name="updateDate" type="TIMESTAMP WITHOUT TIME ZONE"/>
        <column name="version" type="bigint" defaultValue="0"/>
    </createTable>

    <addForeignKeyConstraint
            constraintName="FK_bank-transfer-bank-account"
            baseTableName="bank-transfer"
            baseColumnNames="bankAccountId"
            referencedTableName="bank-account"
            referencedColumnNames="id"
            />
    <createIndex indexName="bank-account__iban"
                 tableName="bank-account"
                 unique="true" >
        <column name="iban"/>
    </createIndex>
    <createIndex indexName="bank-account__owner"
                 tableName="bank-account">
        <column name="owner"/>
    </createIndex>
</changeSet>
</databaseChangeLog>